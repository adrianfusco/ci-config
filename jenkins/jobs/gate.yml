- builder:
    name: 'ci-config-gate-tox'
    builders:
        - shining-panda:
            build-environment: 'virtualenv'
            python-version: 'system-CPython-2.7'
            nature: 'shell'
            clear: true
            use-distribute: false
            system-site-packages: false
            ignore-exit-code: false
            command: |
              # Ensure tox is installed
              pip install tox

              # Run {test} from provided jenkins scm gerrit commit ref
              pushd ci-config
              git log -n 5 --oneline
              tox -e {test}
              result=$?
              exit $result

- job-template:
    name: 'ci-config-gate-tox-{test}'
    defaults: 'parent-promote-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job gates against commits done to <a href="https://github.com/rdo-infra/ci-config" target="_blank">ci-config</a>.</p>
        <p>It leverages tox for testing.</p>
        <br>
        This is what this job runs:
        <pre>
        # Run {test} from provided jenkins scm gerrit commit ref
        pushd ci-config
        git log -n 5 --oneline
        tox -e {test}
        result=$?
        exit $result
        </pre>

    triggers:
        - ci-config-gate-trigger
    scm:
        - ci-config-gate-repository
    builders:
        - ci-config-gate-tox:
            test: '{test}'

- project:
    name: 'ci-config-gate-tox-jobs'
    test:
        - 'jjb'
    jobs:
        - ci-config-gate-tox-{test}
